{% for trip in cost.for_trip %}
{% load l10n %}

<div id="main-cost-tabel-{{ trip.id }}" style="display: none">
    <div class="table-container mb-2">
        <table class="table table-sm text-start small table-borderless rounded-2">
            <thead class="border-bottom border-info">
            <tr>
                <th colspan="7">
                    Trip: {{ trip.name }}
                    <a href="{% url 'add_cost_view' trip_id=trip.id %}"
                       class="btn btn-success bi btn-sm table-button ms-2">
                        Add Cost</a>
                </th>
            </tr>

            <tr>
                <th scope="col">Title</th>
                <th scope="col">Payer</th>
                <th scope="col">Split</th>
                <th scope="col">Cost</th>
                <th scope="col">Person cost</th>
                <th scope="col">Return</th>
                <th scope="col"></th>
            </tr>
            </thead>
            <tbody>

            {% for cost in trip.costs %}
            <tr>
                <td scope="col">
                    {% if cost.who_pay.was_you %}
                    <a href="#"
                       class="d-flex align-items-center p-0" data-bs-toggle="modal"
                       id="edit-cost-title-button-{{ cost.cost_id }}" data-bs-target="#cost-title-modal"
                       data-value-cost-id="{{ cost.cost_id }}" data-value-cost-title="{{ cost.name }}"
                       data-value-trip-id="{{ trip.id }}">
                        {{ cost.name }}
                        <i class="bi bi-pencil-square ms-1" style="color:#6F42C1"></i>
                    </a>
                    {% else %}
                    {{ cost.name }}
                    {% endif %}
                </td>


                <td scope="col">
                    <a href="#" data-bs-toggle="tooltip"
                       data-bs-title="{{ cost.who_pay.name }} {{ cost.who_pay.lastname }}">
                        {{ cost.who_pay.name }}
                    </a>
                </td>

                <td scope="col">
                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle btn-sm table-button" type="button"
                                id="dropdownMenuButtonFriend" data-bs-auto-close="outside"
                                data-bs-toggle="dropdown" aria-expanded="false">Expand
                        </button>
                        <ul class="dropdown-menu background-dropdown-color dropdown-list"
                            aria-labelledby="dropdownMenuButtonFriend"
                            style="max-height: 250px; white-space: nowrap; overflow-y: auto;">
                            {% for data in cost.split_by %}

                            <li class="ps-2 pe-2">
                                {% if cost.who_pay.was_you %}

                                <button type="button" class="btn p-0 me-1" data-bs-toggle="modal"
                                        id="edit-cost-split-button-{{ data.user_id }}"
                                        data-bs-target="#cost-status-modal" data-value-friend-id="{{ data.user_id }}"
                                        data-value-cost-id="{{ cost.cost_id }}"
                                        data-value-friend-name="{{ data.firstname }}"
                                        data-value-trip-id="{{ trip.id }}">

                                    <i class="bi bi-cash-coin me-1"
                                       style="color:{% if data.payment %}green {% else %}red {% endif %};"></i>
                                    <i class="bi bi-pencil-square" style="color:#6F42C1"></i>
                                </button>

                                <a href="#" data-bs-toggle="tooltip"
                                   data-bs-title="{{ data.firstname }} {{ data.lastname }}">
                                    {{ data.firstname }}
                                </a>

                                {% else %}
                                <button type="button" class="btn p-0"
                                        data-bs-toggle="tooltip"
                                        data-bs-title="{{ data.firstname }} {{ data.lastname }}">
                                    <i class="bi bi-cash-coin me-1"
                                       style="color:{% if data.payment %}green {% else %}red {% endif %};"></i>
                                    {{ data.firstname }}
                                </button>
                                {% endif %}

                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </td>
                <td scope="col">
                    {% if cost.who_pay.was_you %}
                    <a href="#"
                       class="d-flex align-items-center p-0" data-bs-toggle="modal"
                       id="edit-cost-value-button-{{ cost.cost_id }}" data-bs-target="#cost-update-modal"
                       data-value-cost-id="{{ cost.cost_id }}" data-value-cost-name="{{ cost.name }}"
                       data-value-trip-id="{{ trip.id }}" data-value-cost-value="{{ cost.cost }}">
                        {% with value=cost.cost %}
                        {{ value|floatformat:2 }}
                        {% endwith %}
                        <i class="bi bi-pencil-square ms-1" style="color:#6F42C1"></i>
                    </a>
                    {% else %}
                    {{ cost.cost }}
                    {% endif %}

                </td>
                <td scope="col">
                    {% with value=cost.unit_cost %}
                    {{ value|floatformat:2 }}
                    {% endwith %}
                </td>
                <td scope="col"
                    style="color:{% if cost.return == '0.00' or cost.return == '0' %}black{% elif cost.who_pay.was_you %}darkgreen{% else %}red{% endif %};">
                    {% with value=cost.return %}
                    {{ value|floatformat:2 }}
                    {% endwith %}
                </td>
                <td scope="col">
                    {% if cost.who_pay.was_you %}
                    <a href="#"
                       class="d-flex" data-bs-toggle="modal"
                       id="edit-cost-remove-button-{{ cost.cost_id }}" data-bs-target="#cost-remove-modal"
                       data-value-cost-id="{{ cost.cost_id }}" data-value-cost-name="{{ cost.name }}"
                       data-value-trip-id="{{ trip.id }}">
                        <i class="bi bi-trash ms-1" style="color:red"></i>
                    </a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}

            </tbody>
        </table>
    </div>


    {% if trip.overall_cost %}
    <div class="row">
        <div class="col-12 d-flex justify-content-start">
            <div class="table-container col-6 col-md-3">
                <table class="table table-sm text-start small table-borderless rounded-2">
                    <thead class="border-bottom border-info">
                    <tr>
                        <th colspan="7">
                            Overall for Trip: {{ trip.name }}
                        </th>
                    </tr>

                    <tr>
                        <th scope="col">Name</th>

                        <th scope="col">Balance</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for overall in trip.overall_cost %}
                    <tr>
                        <td scope="col">
                            {{ overall.firstname }} {{ overall.lastname }}
                        </td>

                        <td scope="col"
                            style="color:{% if overall.return_from.positiv %}red {% else %}green {% endif %}">
                            {% with value=overall.return_from.value %}
                            {{ value|floatformat:2 }}
                            {% endwith %}
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% endfor %}
{% include 'trip_calculator/home_table/cost_edit_modal.html' %}
